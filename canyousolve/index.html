<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- TODO: Replace with your book's title -->
    <title>Can You Solve the Murder?</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the page */
        body {
            font-family: 'Inter', sans-serif;
            /* Add a transition for the background color change */
            transition: background-color 0.8s ease;
        }
        /* Style for the store buttons for a consistent look */
        .store-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-align: center;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            color: white;
        }
        .store-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .amazon-btn { background-color: #FF9900; }
        .barnes-noble-btn { background-color: #2E6B44; }
        .bookshop-btn { background-color: #000000; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <!-- Main Container -->
    <div class="container mx-auto px-4 py-8 sm:px-6 lg:px-8">

        <!-- Back to Main Page Link -->
        <div class="mb-8 text-center md:text-left">
             <!-- TODO: Adjust href if using a project site (e.g., href="../") -->
            <a href="/" class="text-slate-600 hover:text-slate-900 font-semibold inline-flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
                </svg>
                Back to Main
            </a>
        </div>
        
        <!-- Main section for the single book -->
        <main id="book-list" class="flex justify-center mt-10">

            <!-- Container for the two cards -->
            <!-- The `md:items-start` class is added here to prevent columns from stretching to the same height -->
            <div class="w-full max-w-4xl flex flex-col md:flex-row md:items-start gap-8">
                
                <!-- Left Column: Book Cover -->
                <div class="w-full md:w-1/3 flex justify-center">
                    <!-- 
                        TODO: Replace with your book cover image URL.
                        IMPORTANT: The image needs to support cross-origin requests for the color analysis to work.
                        The image itself now acts as the card.
                        Size is constrained on mobile with `max-w-sm` and unconstrained on desktop with `md:max-w-full`.
                    -->
                    <img id="book-cover-image" crossorigin="anonymous" class="w-full max-w-sm md:max-w-full mx-auto h-auto rounded-xl shadow-lg" src="https://m.media-amazon.com/images/I/71i4Ssfts8L._SL1500_.jpg" alt="Book cover for [Book Title Here]" onerror="this.onerror=null;this.src='https://placehold.co/800x1200/cccccc/000000?text=Image+Not+Found';">
                </div>

                <!-- Right Card: Book Information -->
                <div class="w-full md:w-2/3 bg-white rounded-xl shadow-lg p-8 flex flex-col">
                    <!-- TODO: Replace with book title and author name -->
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-2">Can You Solve the Murder?: An Interactive Crime Novel</h2>
                    <h3 class="text-xl md:text-2xl font-medium text-slate-600 mb-6">Antony Johnston</h3>
                    
                    <!-- TODO: Replace with book description -->
                    <p class="text-slate-700 mb-8 leading-relaxed text-base">One murder. Six suspects. One truth for YOU to uncover.<br>
                        <br>
                        YOU are the lead detective and it's your job to investigate the most mysterious crime of your career.<br>
                        <br>
                        There’s been a murder at Elysium, a wellness retreat set in an English country manor. You arrive to find the body of a local businessman on the lawn – with a rose placed in his mouth. It appears he was stabbed with a gardening fork and fell to his death from the balcony above. You quickly realize that balcony can only be accessed through a locked door, the key is missing, and everyone in Elysium is now a suspect… Who did it and why? It’s up to you to figure it out.<br>
                        <br>
                        YOU gather the evidence and examine the clues.<br>
                        <br>
                        YOU choose who to interview next, and who to accuse as your prime suspect.<br>
                        <br>
                        But remember that every decision YOU make has consequences – and some of them will prove fatal…<br></p>
                    
                    <!-- TODO: Replace '#' with your actual store links -->
                    <div class="flex flex-col space-y-3 mt-auto">
                        <a href="https://a.co/d/7YQKytB" target="_blank" rel="noopener noreferrer" class="store-button amazon-btn">
                            Shop on Amazon
                        </a>
                        <a href="https://www.barnesandnoble.com/w/can-you-solve-the-murder-antony-johnston/1146363577" target="_blank" rel="noopener noreferrer" class="store-button barnes-noble-btn">
                            Shop on Barnes & Noble
                        </a>
                        <a href="https://bookshop.org/p/books/can-you-solve-the-murder-an-interactive-crime-novel-antony-johnston/21862485?ean=9780143138884&next=t&affiliate=1967" target="_blank" rel="noopener noreferrer" class="store-button bookshop-btn">
                            Shop on Bookshop.org
                        </a>
                    </div>
                </div>

            </div>

        </main>

        <!-- Footer -->
        <footer class="text-center mt-12 py-4 border-t border-slate-200">
            <p class="text-slate-500"></p>
            <p class="text-sm text-slate-400 mt-1"></p>
        </footer>

    </div>

    <script>
        window.onload = function() {
            const img = document.getElementById('book-cover-image');
            const body = document.body;

            // Make sure the image is loaded before we try to process it
            if (img.complete && img.naturalHeight !== 0) {
                getDominantColor(img);
            } else {
                img.addEventListener('load', function() {
                    getDominantColor(img);
                });
                img.addEventListener('error', function() {
                    console.error("The image could not be loaded.");
                });
            }

            function getDominantColor(imgEl) {
                // FIX: Check if the image has valid dimensions before processing.
                // This prevents errors if the image fails to load properly.
                if (imgEl.naturalWidth === 0 || imgEl.naturalHeight === 0) {
                    console.error("Image has zero dimensions. Cannot extract color.");
                    return;
                }
                try {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Set canvas dimensions to match the image's intrinsic dimensions
                    canvas.width = imgEl.naturalWidth;
                    canvas.height = imgEl.naturalHeight;

                    // Draw the image to the canvas
                    ctx.drawImage(imgEl, 0, 0, canvas.width, canvas.height);

                    // Get the image data from the canvas
                    const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
                    const colorCounts = {};
                    let dominantColor = null;
                    let maxCount = 0;

                    // Loop through pixel data (sampling every 5 pixels for performance)
                    for (let i = 0; i < data.length; i += 20) { // 4 bytes per pixel * 5
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];

                        // Skip pixels that are too white or too black
                        if (r > 240 && g > 240 && b > 240) continue;
                        if (r < 15 && g < 15 && b < 15) continue;

                        const color = `${r},${g},${b}`;
                        colorCounts[color] = (colorCounts[color] || 0) + 1;

                        if (colorCounts[color] > maxCount) {
                            maxCount = colorCounts[color];
                            dominantColor = color.split(',').map(Number);
                        }
                    }

                    if (dominantColor) {
                        // Create a light, desaturated version of the dominant color for the background
                        const [r, g, b] = dominantColor;
                        const pastelColor = `rgba(${r}, ${g}, ${b}, 0.15)`;
                        body.style.backgroundColor = pastelColor;
                    }
                } catch (e) {
                    console.error("Could not process image for color extraction.", e);
                    if (e.name === 'SecurityError') {
                        console.error("This is likely a CORS issue. The image cannot be analyzed because it's from a different origin without the correct 'Access-Control-Allow-Origin' headers.");
                    }
                }
            }
        };
    </script>

</body>
</html>
